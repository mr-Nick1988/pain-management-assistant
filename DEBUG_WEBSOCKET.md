# üêõ WebSocket Debugging - –ü–æ—à–∞–≥–æ–≤–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

## ‚úÖ –°—Ç–∞—Ç—É—Å: –ó–∞–ø—Ä–æ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω —É—Å–ø–µ—à–Ω–æ, –Ω–æ toast –Ω–µ –ø–æ—è–≤–∏–ª—Å—è

### –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:
- ‚úÖ Backend –ø–æ–ª—É—á–∏–ª –∑–∞–ø—Ä–æ—Å
- ‚úÖ Backend –≤–µ—Ä–Ω—É–ª —É—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç: `{"status": "success", "type": "PAIN_ESCALATION", "priority": "HIGH"}`
- ‚úÖ WebSocket –ø–æ–¥–∫–ª—é—á–µ–Ω (–∑–µ–ª–µ–Ω—ã–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä)

### –ß—Ç–æ –ù–ï —Ä–∞–±–æ—Ç–∞–µ—Ç:
- ‚ùå Toast —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –Ω–µ –ø–æ—è–≤–∏–ª–æ—Å—å
- ‚ùì –°–æ–æ–±—â–µ–Ω–∏–µ –¥–æ—à–ª–æ –¥–æ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞?

---

## üîç –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê (–ü–û–®–ê–ì–û–í–û)

### –®–ê–ì 1: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12)

–û—Ç–∫—Ä–æ–π –∫–æ–Ω—Å–æ–ª—å –∏ –Ω–∞–π–¥–∏ —ç—Ç–∏ –ª–æ–≥–∏:

#### ‚úÖ –î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
```
üîå Initializing WebSocket connection to: http://localhost:8080/ws
‚úÖ WebSocket connected successfully
üì° Subscribing to multiple topics for debugging...
‚úÖ Subscribed to all topics successfully
```

#### üì® –ü–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ç–µ—Å—Ç–∞ –¥–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è:
```
üì® [ANESTHESIOLOGIST TOPIC] Received: {...}
‚úÖ Parsed notification: {...}
```

#### ‚ùå –ï—Å–ª–∏ —ç—Ç–æ–≥–æ –ù–ï–¢:
–°–æ–æ–±—â–µ–Ω–∏–µ –Ω–µ –¥–æ—à–ª–æ –¥–æ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞! –ü—Ä–æ–±–ª–µ–º–∞ –Ω–∞ –±—ç–∫–µ–Ω–¥–µ.

---

### –®–ê–ì 2: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –±—ç–∫–µ–Ω–¥–∞

–ü–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ POST –∑–∞–ø—Ä–æ—Å–∞ –≤ –ª–æ–≥–∞—Ö –±—ç–∫–µ–Ω–¥–∞ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:

```
INFO  p.w.s.UnifiedNotificationService : Sending PAIN_ESCALATION notification to /topic/escalations/anesthesiologists
INFO  p.w.s.UnifiedNotificationService : Notification sent successfully
```

#### ‚ùå –ï—Å–ª–∏ —ç—Ç–æ–≥–æ –ù–ï–¢:
Backend –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞ WebSocket —Ç–æ–ø–∏–∫!

---

### –®–ê–ì 3: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö

–ë—ç–∫–µ–Ω–¥ –¥–æ–ª–∂–µ–Ω –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å JSON –≤ —Ç–∞–∫–æ–º —Ñ–æ—Ä–º–∞—Ç–µ:

```json
{
  "type": "PAIN_ESCALATION",
  "priority": "HIGH",
  "patientMrn": "TEST-12345",
  "patientName": "–¢–µ—Å—Ç–æ–≤—ã–π –ü–∞—Ü–∏–µ–Ω—Ç",
  "previousVas": 5,
  "currentVas": 9,
  "vasChange": 4,
  "message": "VAS —É–≤–µ–ª–∏—á–∏–ª—Å—è —Å 5 –¥–æ 9 —á–µ—Ä–µ–∑ 2 —á–∞—Å–∞ –ø–æ—Å–ª–µ –≤–≤–µ–¥–µ–Ω–∏—è –¥–æ–∑—ã",
  "timestamp": "2025-11-01T18:00:00"
}
```

#### ‚ùå –ï—Å–ª–∏ —Ñ–æ—Ä–º–∞—Ç –¥—Ä—É–≥–æ–π:
Frontend –Ω–µ —Å–º–æ–∂–µ—Ç —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å –∏ –ø–æ–∫–∞–∑–∞—Ç—å toast!

---

## üß™ –¢–ï–°–¢–´ –î–õ–Ø –ü–†–û–í–ï–†–ö–ò

### –¢–µ—Å—Ç 1: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –±—ç–∫–µ–Ω–¥ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç

```bash
# –í –ª–æ–≥–∞—Ö –±—ç–∫–µ–Ω–¥–∞ –ø–æ—Å–ª–µ —ç—Ç–æ–π –∫–æ–º–∞–Ω–¥—ã –¥–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è "Sending notification"
curl -X POST http://localhost:8080/api/websocket/test/pain-escalation
```

### –¢–µ—Å—Ç 2: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞

1. –û—Ç–∫—Ä—ã—Ç—å F12 (–∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞)
2. –ù–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É "üß™ Send Test Notification" –Ω–∞ –¥–∞—à–±–æ—Ä–¥–µ
3. –°–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏

**–û–∂–∏–¥–∞–µ–º—ã–µ –ª–æ–≥–∏:**
```
üß™ Sending test notification...
‚úÖ Test response: {status: "success", ...}
üì® [ANESTHESIOLOGIST TOPIC] Received: {...}
‚úÖ Parsed notification: {...}
```

### –¢–µ—Å—Ç 3: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ —Ç–æ–ø–∏–∫–∏

–°–µ–π—á–∞—Å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –ø–æ–¥–ø–∏—Å–∞–Ω –Ω–∞ 3 —Ç–æ–ø–∏–∫–∞:
- `/topic/escalations/anesthesiologists`
- `/topic/escalations/critical`
- `/topic/escalations/dashboard`

–ï—Å–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–∏–¥–µ—Ç –Ω–∞ –õ–Æ–ë–û–ô –∏–∑ –Ω–∏—Ö - —É–≤–∏–¥–∏—à—å –≤ –∫–æ–Ω—Å–æ–ª–∏!

---

## üîß –í–û–ó–ú–û–ñ–ù–´–ï –ü–†–û–ë–õ–ï–ú–´ –ò –†–ï–®–ï–ù–ò–Ø

### –ü—Ä–æ–±–ª–µ–º–∞ 1: –°–æ–æ–±—â–µ–Ω–∏–µ –Ω–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥

**–°–∏–º–ø—Ç–æ–º—ã:**
- –í –∫–æ–Ω—Å–æ–ª–∏ –ù–ï–¢ –ª–æ–≥–∞ `üì® [ANESTHESIOLOGIST TOPIC] Received`
- Backend –≤–µ—Ä–Ω—É–ª success, –Ω–æ –Ω–∏—á–µ–≥–æ –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç

**–ü—Ä–∏—á–∏–Ω–∞:**
Backend –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞ WebSocket —Ç–æ–ø–∏–∫

**–†–µ—à–µ–Ω–∏–µ:**
–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–¥ –±—ç–∫–µ–Ω–¥–∞ –≤ `WebSocketTestController.java`:

```java
@PostMapping("/test/pain-escalation")
public ResponseEntity<?> testPainEscalation() {
    // –î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
    messagingTemplate.convertAndSend(
        "/topic/escalations/anesthesiologists",  // ‚Üê –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ç–æ–ø–∏–∫
        notification
    );
    
    // –ù–ï –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
    // return ResponseEntity.ok("success"); // ‚Üê –¢–æ–ª—å–∫–æ HTTP –æ—Ç–≤–µ—Ç, –±–µ–∑ WebSocket!
}
```

---

### –ü—Ä–æ–±–ª–µ–º–∞ 2: –°–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç, –Ω–æ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç

**–°–∏–º–ø—Ç–æ–º—ã:**
- –í –∫–æ–Ω—Å–æ–ª–∏ –µ—Å—Ç—å `üì® Received: {...}`
- –ù–æ –µ—Å—Ç—å –æ—à–∏–±–∫–∞ `‚ùå Error parsing notification`

**–ü—Ä–∏—á–∏–Ω–∞:**
Backend –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ

**–†–µ—à–µ–Ω–∏–µ:**
–ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ backend –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ–±—ä–µ–∫—Ç `PainEscalationNotificationDTO` —Å –ø–æ–ª—è–º–∏:
- `patientMrn`
- `patientName`
- `previousVas`
- `currentVas`
- `vasChange`
- `priority`

---

### –ü—Ä–æ–±–ª–µ–º–∞ 3: –°–æ–æ–±—â–µ–Ω–∏–µ –ø–∞—Ä—Å–∏—Ç—Å—è, –Ω–æ toast –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è

**–°–∏–º–ø—Ç–æ–º—ã:**
- –í –∫–æ–Ω—Å–æ–ª–∏ –µ—Å—Ç—å `‚úÖ Parsed notification: {...}`
- –ù–æ toast –Ω–µ –ø–æ—è–≤–ª—è–µ—Ç—Å—è

**–ü—Ä–∏—á–∏–Ω–∞:**
–ü—Ä–æ–±–ª–µ–º–∞ —Å ToastContext

**–†–µ—à–µ–Ω–∏–µ:**
–ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ `toast.warning()` —Ä–∞–±–æ—Ç–∞–µ—Ç:

```javascript
// –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞:
toast.warning('Test toast');
```

–ï—Å–ª–∏ toast –Ω–µ –ø–æ—è–≤–ª—è–µ—Ç—Å—è - –ø—Ä–æ–±–ª–µ–º–∞ –≤ ToastContext!

---

## üìã CHECKLIST –î–ò–ê–ì–ù–û–°–¢–ò–ö–ò

–ü—Ä–æ–π–¥–∏ –ø–æ –ø–æ—Ä—è–¥–∫—É –∏ –æ—Ç–º–µ—Ç—å, —á—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:

- [ ] WebSocket –ø–æ–¥–∫–ª—é—á–µ–Ω (–∑–µ–ª–µ–Ω—ã–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä)
- [ ] –í –∫–æ–Ω—Å–æ–ª–∏: `‚úÖ WebSocket connected successfully`
- [ ] –í –∫–æ–Ω—Å–æ–ª–∏: `‚úÖ Subscribed to all topics successfully`
- [ ] POST –∑–∞–ø—Ä–æ—Å –≤–µ—Ä–Ω—É–ª `{"status": "success"}`
- [ ] –í –ª–æ–≥–∞—Ö –±—ç–∫–µ–Ω–¥–∞: `Sending notification to /topic/...`
- [ ] –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞: `üì® [ANESTHESIOLOGIST TOPIC] Received`
- [ ] –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞: `‚úÖ Parsed notification`
- [ ] Toast —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ—è–≤–∏–ª–æ—Å—å

**–ì–¥–µ –æ—Å—Ç–∞–Ω–æ–≤–∏–ª–æ—Å—å?** ‚Üê –≠—Ç–æ –ø–æ–∫–∞–∂–µ—Ç, –≥–¥–µ –ø—Ä–æ–±–ª–µ–º–∞!

---

## üéØ –ë–´–°–¢–†–ê–Ø –ü–†–û–í–ï–†–ö–ê (30 —Å–µ–∫—É–Ω–¥)

1. **–û—Ç–∫—Ä—ã—Ç—å –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12)**
2. **–ù–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É "üß™ Send Test Notification"**
3. **–°–º–æ—Ç—Ä–µ—Ç—å –∫–æ–Ω—Å–æ–ª—å:**

### –í–∞—Ä–∏–∞–Ω—Ç A: –°–æ–æ–±—â–µ–Ω–∏–µ –ù–ï –ø—Ä–∏—à–ª–æ
```
üß™ Sending test notification...
‚úÖ Test response: {status: "success"}
(–±–æ–ª—å—à–µ –Ω–∏—á–µ–≥–æ –Ω–µ—Ç)
```
**‚Üí –ü—Ä–æ–±–ª–µ–º–∞ –Ω–∞ –±—ç–∫–µ–Ω–¥–µ! Backend –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞ WebSocket.**

### –í–∞—Ä–∏–∞–Ω—Ç B: –°–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–∏—à–ª–æ, –Ω–æ –æ—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞
```
üß™ Sending test notification...
‚úÖ Test response: {status: "success"}
üì® [ANESTHESIOLOGIST TOPIC] Received: {...}
‚ùå Error parsing notification: ...
```
**‚Üí –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö –æ—Ç –±—ç–∫–µ–Ω–¥–∞!**

### –í–∞—Ä–∏–∞–Ω—Ç C: –í—Å—ë —Ä–∞—Å–ø–∞—Ä—Å–∏–ª–æ—Å—å, –Ω–æ toast –Ω–µ –ø–æ–∫–∞–∑–∞–ª—Å—è
```
üß™ Sending test notification...
‚úÖ Test response: {status: "success"}
üì® [ANESTHESIOLOGIST TOPIC] Received: {...}
‚úÖ Parsed notification: {...}
(toast –Ω–µ –ø–æ—è–≤–∏–ª—Å—è)
```
**‚Üí –ü—Ä–æ–±–ª–µ–º–∞ —Å ToastContext!**

---

## üöÄ –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò

### –ï—Å–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –ù–ï –ø—Ä–∏—Ö–æ–¥–∏—Ç:

1. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –±—ç–∫–µ–Ω–¥ –∫–æ–¥:**
   - –§–∞–π–ª: `WebSocketTestController.java`
   - –ú–µ—Ç–æ–¥: `testPainEscalation()`
   - –î–æ–ª–∂–µ–Ω –≤—ã–∑—ã–≤–∞—Ç—å: `messagingTemplate.convertAndSend(...)`

2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –±—ç–∫–µ–Ω–¥–∞:**
   ```bash
   tail -f logs/application.log | grep "WebSocket\|notification"
   ```

3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å WebSocket –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:**
   - –§–∞–π–ª: `WebSocketConfig.java`
   - Endpoint: `/ws`
   - Broker: `/topic`

### –ï—Å–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç, –Ω–æ toast –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è:

1. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å ToastContext:**
   ```javascript
   // –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞:
   toast.warning('Manual test');
   ```

2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö:**
   ```javascript
   // –í –∫–æ–Ω—Å–æ–ª–∏ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ–ª–Ω—ã–π –æ–±—ä–µ–∫—Ç:
   console.log('Notification:', notification);
   ```

---

## üìû –ß–¢–û –°–û–û–ë–©–ò–¢–¨ –ú–ù–ï

–°–∫–æ–ø–∏—Ä—É–π –∏ –æ—Ç–ø—Ä–∞–≤—å:

1. **–ß—Ç–æ –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ –ø–æ—Å–ª–µ –Ω–∞–∂–∞—Ç–∏—è –∫–Ω–æ–ø–∫–∏ —Ç–µ—Å—Ç–∞?**
   ```
   (—Å–∫–æ–ø–∏—Ä—É–π –≤—Å–µ –ª–æ–≥–∏ –∏–∑ –∫–æ–Ω—Å–æ–ª–∏)
   ```

2. **–ß—Ç–æ –≤ –ª–æ–≥–∞—Ö –±—ç–∫–µ–Ω–¥–∞ –ø–æ—Å–ª–µ POST –∑–∞–ø—Ä–æ—Å–∞?**
   ```
   (—Å–∫–æ–ø–∏—Ä—É–π –ª–æ–≥–∏ —Å "WebSocket" –∏–ª–∏ "notification")
   ```

3. **–ö–∞–∫–æ–π –ø—É–Ω–∫—Ç checklist –ù–ï –ø—Ä–æ—à–µ–ª?**
   ```
   –ù–∞–ø—Ä–∏–º–µ—Ä: "–í –∫–æ–Ω—Å–æ–ª–∏ –ù–ï–¢ –ª–æ–≥–∞ 'üì® Received'"
   ```

–≠—Ç–æ –ø–æ–º–æ–∂–µ—Ç —Ç–æ—á–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—É! üéØ
